{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/lib/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\r\n \r\nconst globalForPrisma = globalThis as unknown as { prisma: PrismaClient }\r\n \r\nexport const db = globalForPrisma.prisma || new PrismaClient()\r\n \r\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = db"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAEjB,MAAM,KAAK,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAE5D,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 29, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/app/data/user/sync-user.ts"],"sourcesContent":["// src/app/data/user/sync-user.ts\r\nimport { db } from \"@/lib/db\";\r\nimport { getKindeServerSession } from \"@kinde-oss/kinde-auth-nextjs/server\";\r\n\r\nexport const syncUser = async () => {\r\n  const { getUser } = getKindeServerSession();\r\n  const user = await getUser();\r\n\r\n  if (!user) return null;\r\n\r\n  // Find the existing user in DB\r\n  const existingUser = await db.user.findUnique({\r\n    where: { id: user.id },\r\n  });\r\n\r\n  // If user doesn't exist, skip sync\r\n  if (!existingUser) {\r\n    console.log(\"syncUser: user not found in DB, skipping.\");\r\n    return user;\r\n  }\r\n\r\n  // If user.picture is a valid image and not gravatar, use it\r\n  const imageUrl =\r\n    user.picture && !user.picture.includes(\"gravatar.com\")\r\n      ? user.picture\r\n      : null;\r\n\r\n  // Only update if the image value differs\r\n  if (existingUser.image !== imageUrl) {\r\n    await db.user.update({\r\n      where: { id: user.id },\r\n      data: {\r\n        image: imageUrl, // set to either Google image or null\r\n      },\r\n    });\r\n    console.log(\"syncUser: updated image for\", user.id);\r\n  }\r\n\r\n  return user;\r\n};\r\n"],"names":[],"mappings":"AAAA,iCAAiC;;;;;AACjC;AACA;AAAA;;;AAEO,MAAM,WAAW;IACtB,MAAM,EAAE,OAAO,EAAE,GAAG,IAAA,+QAAqB;IACzC,MAAM,OAAO,MAAM;IAEnB,IAAI,CAAC,MAAM,OAAO;IAElB,+BAA+B;IAC/B,MAAM,eAAe,MAAM,+GAAE,CAAC,IAAI,CAAC,UAAU,CAAC;QAC5C,OAAO;YAAE,IAAI,KAAK,EAAE;QAAC;IACvB;IAEA,mCAAmC;IACnC,IAAI,CAAC,cAAc;QACjB,QAAQ,GAAG,CAAC;QACZ,OAAO;IACT;IAEA,4DAA4D;IAC5D,MAAM,WACJ,KAAK,OAAO,IAAI,CAAC,KAAK,OAAO,CAAC,QAAQ,CAAC,kBACnC,KAAK,OAAO,GACZ;IAEN,yCAAyC;IACzC,IAAI,aAAa,KAAK,KAAK,UAAU;QACnC,MAAM,+GAAE,CAAC,IAAI,CAAC,MAAM,CAAC;YACnB,OAAO;gBAAE,IAAI,KAAK,EAAE;YAAC;YACrB,MAAM;gBACJ,OAAO;YACT;QACF;QACA,QAAQ,GAAG,CAAC,+BAA+B,KAAK,EAAE;IACpD;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/app/data/user/is-user-authenticated.ts"],"sourcesContent":["import { getKindeServerSession } from \"@kinde-oss/kinde-auth-nextjs/server\";\r\nimport { redirect } from \"next/navigation\";\r\nimport { syncUser } from \"./sync-user\";\r\n\r\nexport const userRequired = async () => {\r\n  try {\r\n    const { isAuthenticated, getUser } = getKindeServerSession();\r\n    const isUserAuthenticated = await isAuthenticated();\r\n    if (!isUserAuthenticated) redirect(\"/api/auth/login\");\r\n\r\n   \r\n     const user = await syncUser();\r\n\r\n    return { user, isUserAuthenticated };\r\n  } catch (error) {\r\n    console.error(\"Error in userRequired:\", error);\r\n    redirect(\"/api/auth/login\");\r\n  }\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AAAA;AACA;;;;AAEO,MAAM,eAAe;IAC1B,IAAI;QACF,MAAM,EAAE,eAAe,EAAE,OAAO,EAAE,GAAG,IAAA,+QAAqB;QAC1D,MAAM,sBAAsB,MAAM;QAClC,IAAI,CAAC,qBAAqB,IAAA,iMAAQ,EAAC;QAGlC,MAAM,OAAO,MAAM,IAAA,+IAAQ;QAE5B,OAAO;YAAE;YAAM;QAAoB;IACrC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,IAAA,iMAAQ,EAAC;IACX;AACF","debugId":null}},
    {"offset": {"line": 105, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/lib/schema.ts"],"sourcesContent":["import {z} from \"zod\"\r\n\r\nexport const userSchema = z.object({\r\n    name:z.string().min(2, \"Name is required\").max(50, \"Maximum is 50 characters\"),\r\n    about: z.string().optional(),\r\n    country: z.string().min(1, \"Country is required\"),\r\n    industryType: z.string().min(1, \"Industry type is required\"),\r\n    //email: z.string().email(\"Invalid email address\"),\r\n    email: z.email(\"Invalid email address\"),\r\n    role: z.string().min(1, \"Role is required\"),\r\n    image: z.string().optional(),\r\n})\r\n\r\nexport const workspaceSchema = z.object({\r\n    name:z\r\n    .string()\r\n    .min(2, \"Name is required\")\r\n    .max(50, \"Maximum is 50 characters\"),\r\n    description: z.string().optional(),\r\n})\r\n\r\nexport const projectSchema = z.object({\r\n    name:z\r\n    .string()\r\n    .min(3,{message:\"Project name must be at least 3 characters.\"}),\r\n    description: z.string().optional(),\r\n    workspaceId: z.string(),\r\n    memberAccess: z.array(z.string()).optional(),\r\n})\r\nexport const taskFormSchema = z.object({\r\n    title: z.string().min(1, \"Title is Required\"),\r\n    description: z.string().optional(),\r\n    assigneeId: z.string().optional(),\r\n    status: z.enum([\r\n        \"TODO\",\r\n        \"IN_PROGRESS\",\r\n        \"COMPLETED\",\r\n        \"BLOCKED\",\r\n        \"BACKLOG\",\r\n        \"IN_REVIEW\",\r\n    ]),\r\n    dueDate:z.date(),\r\n    startDate:z.date(),\r\n    priority:z.enum([\"LOW\",\"MEDIUM\",\"HIGH\",\"CRITICAL\"]),\r\n    attachments:z\r\n    .array(\r\n        z.object({\r\n            name:z.string(),\r\n            url:z.string(),\r\n            type:z.enum([\"IMAGE\",\"PDF\"]),\r\n        })\r\n    )\r\n    .optional(),\r\n})"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAEO,MAAM,aAAa,kLAAC,CAAC,MAAM,CAAC;IAC/B,MAAK,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,oBAAoB,GAAG,CAAC,IAAI;IACnD,OAAO,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAC1B,SAAS,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAC3B,cAAc,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAChC,mDAAmD;IACnD,OAAO,kLAAC,CAAC,KAAK,CAAC;IACf,MAAM,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IACxB,OAAO,kLAAC,CAAC,MAAM,GAAG,QAAQ;AAC9B;AAEO,MAAM,kBAAkB,kLAAC,CAAC,MAAM,CAAC;IACpC,MAAK,kLAAC,CACL,MAAM,GACN,GAAG,CAAC,GAAG,oBACP,GAAG,CAAC,IAAI;IACT,aAAa,kLAAC,CAAC,MAAM,GAAG,QAAQ;AACpC;AAEO,MAAM,gBAAgB,kLAAC,CAAC,MAAM,CAAC;IAClC,MAAK,kLAAC,CACL,MAAM,GACN,GAAG,CAAC,GAAE;QAAC,SAAQ;IAA6C;IAC7D,aAAa,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAChC,aAAa,kLAAC,CAAC,MAAM;IACrB,cAAc,kLAAC,CAAC,KAAK,CAAC,kLAAC,CAAC,MAAM,IAAI,QAAQ;AAC9C;AACO,MAAM,iBAAiB,kLAAC,CAAC,MAAM,CAAC;IACnC,OAAO,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IACzB,aAAa,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAChC,YAAY,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAC/B,QAAQ,kLAAC,CAAC,IAAI,CAAC;QACX;QACA;QACA;QACA;QACA;QACA;KACH;IACD,SAAQ,kLAAC,CAAC,IAAI;IACd,WAAU,kLAAC,CAAC,IAAI;IAChB,UAAS,kLAAC,CAAC,IAAI,CAAC;QAAC;QAAM;QAAS;QAAO;KAAW;IAClD,aAAY,kLAAC,CACZ,KAAK,CACF,kLAAC,CAAC,MAAM,CAAC;QACL,MAAK,kLAAC,CAAC,MAAM;QACb,KAAI,kLAAC,CAAC,MAAM;QACZ,MAAK,kLAAC,CAAC,IAAI,CAAC;YAAC;YAAQ;SAAM;IAC/B,IAEH,QAAQ;AACb","debugId":null}},
    {"offset": {"line": 172, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/app/actions/user.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { UserDataType } from \"@/components/onboarding-form\";\r\nimport { userRequired } from \"../data/user/is-user-authenticated\";\r\nimport { userSchema } from \"@/lib/schema\";\r\nimport { db } from \"@/lib/db\";\r\nimport { redirect } from \"next/navigation\";\r\n\r\nexport const createUser = async (data: UserDataType) => {\r\n    const {user} = await userRequired()\r\n    const validatedData = userSchema.parse(data)\r\n    const userData = await db.user.create({\r\n        data: {\r\n            id: user.id,\r\n            email: user.email as string,\r\n            name: validatedData.name,\r\n            about: validatedData.about, \r\n            country: validatedData.country,\r\n            industryType: validatedData.industryType, \r\n            role: validatedData. role,\r\n            onboardingCompleted: true,\r\n            image: user.picture || \"\",\r\n            subscription: {\r\n                create: {\r\n                    plan: \"FREE\",\r\n                    status: \"ACTIVE\",\r\n                    currentPeriodEnd: new Date(),\r\n                    cancelAtPeriodEnd: false,\r\n                },\r\n            },\r\n        },\r\n        select: {\r\n            id: true,\r\n            name: true,\r\n            email: true,\r\n            workspaces: true,\r\n        },\r\n    });\r\n    if(userData.workspaces.length === 0){\r\n        redirect(\"/create-workspace\");\r\n    }\r\n    redirect(\"/workspace\");\r\n};"],"names":[],"mappings":";;;;;AAGA;AACA;AACA;AACA;AAAA;;;;;;;AAEO,MAAM,aAAa,OAAO;IAC7B,MAAM,EAAC,IAAI,EAAC,GAAG,MAAM,IAAA,kKAAY;IACjC,MAAM,gBAAgB,2HAAU,CAAC,KAAK,CAAC;IACvC,MAAM,WAAW,MAAM,+GAAE,CAAC,IAAI,CAAC,MAAM,CAAC;QAClC,MAAM;YACF,IAAI,KAAK,EAAE;YACX,OAAO,KAAK,KAAK;YACjB,MAAM,cAAc,IAAI;YACxB,OAAO,cAAc,KAAK;YAC1B,SAAS,cAAc,OAAO;YAC9B,cAAc,cAAc,YAAY;YACxC,MAAM,cAAe,IAAI;YACzB,qBAAqB;YACrB,OAAO,KAAK,OAAO,IAAI;YACvB,cAAc;gBACV,QAAQ;oBACJ,MAAM;oBACN,QAAQ;oBACR,kBAAkB,IAAI;oBACtB,mBAAmB;gBACvB;YACJ;QACJ;QACA,QAAQ;YACJ,IAAI;YACJ,MAAM;YACN,OAAO;YACP,YAAY;QAChB;IACJ;IACA,IAAG,SAAS,UAAU,CAAC,MAAM,KAAK,GAAE;QAChC,IAAA,iMAAQ,EAAC;IACb;IACA,IAAA,iMAAQ,EAAC;AACb;;;IAlCa;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 240, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/app/data/workspace/get-user-workspaces.ts"],"sourcesContent":["import { db } from \"@/lib/db\";\r\nimport { userRequired } from \"../user/is-user-authenticated\";\r\n\r\nexport const getUserWorkspaces = async () => {\r\n    try{\r\n        const { user } = await userRequired();\r\n\r\n        const workspaces = await db.user.findUnique({\r\n            where: {id: user.id},\r\n            include: {\r\n                workspaces: {\r\n                    select: {\r\n                        id: true,\r\n                        userId: true,\r\n                        workspaceId: true,\r\n                        accessLevel: true,\r\n                        createdAt: true,\r\n                        workspace: {select: {name: true}},\r\n                    },\r\n                },\r\n            },\r\n        });\r\n        return {data:workspaces}\r\n    }catch (error) {\r\n        console.log(error)\r\n        return{\r\n            success:false,\r\n            error:true,\r\n            message: \"Failed to fetch workspaces\",\r\n            status: 500,\r\n        };\r\n    }\r\n};"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,MAAM,oBAAoB;IAC7B,IAAG;QACC,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,kKAAY;QAEnC,MAAM,aAAa,MAAM,+GAAE,CAAC,IAAI,CAAC,UAAU,CAAC;YACxC,OAAO;gBAAC,IAAI,KAAK,EAAE;YAAA;YACnB,SAAS;gBACL,YAAY;oBACR,QAAQ;wBACJ,IAAI;wBACJ,QAAQ;wBACR,aAAa;wBACb,aAAa;wBACb,WAAW;wBACX,WAAW;4BAAC,QAAQ;gCAAC,MAAM;4BAAI;wBAAC;oBACpC;gBACJ;YACJ;QACJ;QACA,OAAO;YAAC,MAAK;QAAU;IAC3B,EAAC,OAAO,OAAO;QACX,QAAQ,GAAG,CAAC;QACZ,OAAM;YACF,SAAQ;YACR,OAAM;YACN,SAAS;YACT,QAAQ;QACZ;IACJ;AACJ","debugId":null}},
    {"offset": {"line": 289, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/components/onboarding-form.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const OnboardingForm = registerClientReference(\n    function() { throw new Error(\"Attempted to call OnboardingForm() from the server but OnboardingForm is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/onboarding-form.tsx <module evaluation>\",\n    \"OnboardingForm\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,iBAAiB,IAAA,wQAAuB,EACjD;IAAa,MAAM,IAAI,MAAM;AAA4O,GACzQ,gEACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 303, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/components/onboarding-form.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const OnboardingForm = registerClientReference(\n    function() { throw new Error(\"Attempted to call OnboardingForm() from the server but OnboardingForm is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/onboarding-form.tsx\",\n    \"OnboardingForm\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,iBAAiB,IAAA,wQAAuB,EACjD;IAAa,MAAM,IAAI,MAAM;AAA4O,GACzQ,4CACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 317, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 325, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/app/%28protected%29/onboarding/page.tsx"],"sourcesContent":["import { userRequired } from '@/app/data/user/is-user-authenticated';\r\nimport { getUserWorkspaces } from '@/app/data/workspace/get-user-workspaces'\r\nimport { OnboardingForm } from '@/components/onboarding-form';\r\nimport { redirect } from 'next/navigation';\r\nimport React from 'react'\r\n\r\nconst page = async () => {\r\n  const {data} = await getUserWorkspaces();\r\n  const {user} = await userRequired();\r\n  if (data?.onboardingCompleted && data?.workspaces.length > 0){\r\n    redirect (\"/workspace\")\r\n  } else if(data?.onboardingCompleted){\r\n    redirect(\"/create-workspace\")\r\n  }\r\n\r\n  const name = `${user?.given_name ||\"\"} ${user?.family_name ||\"\"}`\r\n  return (\r\n    <div className=''>\r\n      <OnboardingForm \r\n        name={name} \r\n        email={user?.email as string} \r\n        image={user?.picture || \"\"}\r\n      />\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default page\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AAAA;;;;;;AAGA,MAAM,OAAO;IACX,MAAM,EAAC,IAAI,EAAC,GAAG,MAAM,IAAA,0KAAiB;IACtC,MAAM,EAAC,IAAI,EAAC,GAAG,MAAM,IAAA,kKAAY;IACjC,IAAI,MAAM,uBAAuB,MAAM,WAAW,SAAS,GAAE;QAC3D,IAAA,iMAAQ,EAAE;IACZ,OAAO,IAAG,MAAM,qBAAoB;QAClC,IAAA,iMAAQ,EAAC;IACX;IAEA,MAAM,OAAO,GAAG,MAAM,cAAa,GAAG,CAAC,EAAE,MAAM,eAAc,IAAI;IACjE,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC,mJAAc;YACb,MAAM;YACN,OAAO,MAAM;YACb,OAAO,MAAM,WAAW;;;;;;;;;;;AAIhC;uCAEe","debugId":null}}]
}