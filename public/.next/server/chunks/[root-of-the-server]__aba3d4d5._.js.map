{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 67, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/lib/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\r\n \r\nconst globalForPrisma = globalThis as unknown as { prisma: PrismaClient }\r\n \r\nexport const db = globalForPrisma.prisma || new PrismaClient()\r\n \r\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = db"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAEjB,MAAM,KAAK,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAE5D,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 80, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/app/data/user/sync-user.ts"],"sourcesContent":["// src/app/data/user/sync-user.ts\r\nimport { db } from \"@/lib/db\";\r\nimport { getKindeServerSession } from \"@kinde-oss/kinde-auth-nextjs/server\";\r\n\r\nexport const syncUser = async () => {\r\n  const { getUser } = getKindeServerSession();\r\n  const user = await getUser();\r\n\r\n  if (!user) return null;\r\n\r\n  // Find the existing user in DB\r\n  const existingUser = await db.user.findUnique({\r\n    where: { id: user.id },\r\n  });\r\n\r\n  // If user doesn't exist, skip sync\r\n  if (!existingUser) {\r\n    console.log(\"syncUser: user not found in DB, skipping.\");\r\n    return user;\r\n  }\r\n\r\n  // If user.picture is a valid image and not gravatar, use it\r\n  const imageUrl =\r\n    user.picture && !user.picture.includes(\"gravatar.com\")\r\n      ? user.picture\r\n      : null;\r\n\r\n  // Only update if the image value differs\r\n  if (existingUser.image !== imageUrl) {\r\n    await db.user.update({\r\n      where: { id: user.id },\r\n      data: {\r\n        image: imageUrl, // set to either Google image or null\r\n      },\r\n    });\r\n    console.log(\"syncUser: updated image for\", user.id);\r\n  }\r\n\r\n  return user;\r\n};\r\n"],"names":[],"mappings":"AAAA,iCAAiC;;;;;AACjC;AACA;AAAA;;;AAEO,MAAM,WAAW;IACtB,MAAM,EAAE,OAAO,EAAE,GAAG,IAAA,iRAAqB;IACzC,MAAM,OAAO,MAAM;IAEnB,IAAI,CAAC,MAAM,OAAO;IAElB,+BAA+B;IAC/B,MAAM,eAAe,MAAM,iHAAE,CAAC,IAAI,CAAC,UAAU,CAAC;QAC5C,OAAO;YAAE,IAAI,KAAK,EAAE;QAAC;IACvB;IAEA,mCAAmC;IACnC,IAAI,CAAC,cAAc;QACjB,QAAQ,GAAG,CAAC;QACZ,OAAO;IACT;IAEA,4DAA4D;IAC5D,MAAM,WACJ,KAAK,OAAO,IAAI,CAAC,KAAK,OAAO,CAAC,QAAQ,CAAC,kBACnC,KAAK,OAAO,GACZ;IAEN,yCAAyC;IACzC,IAAI,aAAa,KAAK,KAAK,UAAU;QACnC,MAAM,iHAAE,CAAC,IAAI,CAAC,MAAM,CAAC;YACnB,OAAO;gBAAE,IAAI,KAAK,EAAE;YAAC;YACrB,MAAM;gBACJ,OAAO;YACT;QACF;QACA,QAAQ,GAAG,CAAC,+BAA+B,KAAK,EAAE;IACpD;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 125, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/app/data/user/is-user-authenticated.ts"],"sourcesContent":["import { getKindeServerSession } from \"@kinde-oss/kinde-auth-nextjs/server\";\r\nimport { redirect } from \"next/navigation\";\r\nimport { syncUser } from \"./sync-user\";\r\n\r\nexport const userRequired = async () => {\r\n  try {\r\n    const { isAuthenticated, getUser } = getKindeServerSession();\r\n    const isUserAuthenticated = await isAuthenticated();\r\n    if (!isUserAuthenticated) redirect(\"/api/auth/login\");\r\n\r\n   \r\n     const user = await syncUser();\r\n\r\n    return { user, isUserAuthenticated };\r\n  } catch (error) {\r\n    console.error(\"Error in userRequired:\", error);\r\n    redirect(\"/api/auth/login\");\r\n  }\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AAAA;AACA;;;;AAEO,MAAM,eAAe;IAC1B,IAAI;QACF,MAAM,EAAE,eAAe,EAAE,OAAO,EAAE,GAAG,IAAA,iRAAqB;QAC1D,MAAM,sBAAsB,MAAM;QAClC,IAAI,CAAC,qBAAqB,IAAA,mMAAQ,EAAC;QAGlC,MAAM,OAAO,MAAM,IAAA,iJAAQ;QAE5B,OAAO;YAAE;YAAM;QAAoB;IACrC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,IAAA,mMAAQ,EAAC;IACX;AACF","debugId":null}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/app/api/uploadthing/core.ts"],"sourcesContent":["import { userRequired } from \"@/app/data/user/is-user-authenticated\";\r\nimport { createUploadthing, type FileRouter } from \"uploadthing/next\";\r\nimport { UploadThingError } from \"uploadthing/server\";\r\n\r\nconst f = createUploadthing();\r\n\r\n\r\n// FileRouter for your app, can contain multiple FileRoutes\r\nexport const ourFileRouter = {\r\n  // Define as many FileRoutes as you like, each with a unique routeSlug\r\n  imageUploader: f({\r\n    image: {\r\n      /**\r\n       * For full list of options and defaults, see the File Route API reference\r\n       * @see https://docs.uploadthing.com/file-routes#route-config\r\n       */\r\n      maxFileSize: \"1MB\",\r\n      maxFileCount: 3,\r\n    },\r\n  })\r\n    // Set permissions and file types for this FileRoute\r\n    .middleware(async ({ req }) => {\r\n      // This code runs on your server before upload\r\n      const {user} = await userRequired()\r\n\r\n      // If you throw, the user will not be able to upload\r\n      if (!user) throw new UploadThingError(\"Unauthorized\");\r\n\r\n      // Whatever is returned here is accessible in onUploadComplete as `metadata`\r\n      return { userId: user.id };\r\n    })\r\n    .onUploadComplete(async ({ metadata, file }) => {\r\n      // This code RUNS ON YOUR SERVER after upload\r\n      console.log(\"Upload complete for userId:\", metadata.userId);\r\n\r\n      console.log(\"file url\", file.ufsUrl);\r\n\r\n      // !!! Whatever is returned here is sent to the clientside `onClientUploadComplete` callback\r\n      return { uploadedBy: metadata.userId };\r\n    }),\r\n    documentUploader: f({\r\n    \"application/pdf\": {\r\n      /**\r\n       * For full list of options and defaults, see the File Route API reference\r\n       * @see https://docs.uploadthing.com/file-routes#route-config\r\n       */\r\n      maxFileSize: \"1MB\",\r\n      maxFileCount: 3,\r\n    },\r\n  })\r\n    // Set permissions and file types for this FileRoute\r\n    .middleware(async ({ req }) => {\r\n      // This code runs on your server before upload\r\n      const {user} = await userRequired()\r\n\r\n      // If you throw, the user will not be able to upload\r\n      if (!user) throw new UploadThingError(\"Unauthorized\");\r\n\r\n      // Whatever is returned here is accessible in onUploadComplete as `metadata`\r\n      return { userId: user.id };\r\n    })\r\n    .onUploadComplete(async ({ metadata, file }) => {\r\n      // This code RUNS ON YOUR SERVER after upload\r\n      console.log(\"Upload complete for userId:\", metadata.userId);\r\n\r\n      console.log(\"file url\", file.ufsUrl);\r\n\r\n      // !!! Whatever is returned here is sent to the clientside `onClientUploadComplete` callback\r\n      return { uploadedBy: metadata.userId };\r\n    })\r\n} satisfies FileRouter;\r\n\r\nexport type OurFileRouter = typeof ourFileRouter;\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,MAAM,IAAI,IAAA,mLAAiB;AAIpB,MAAM,gBAAgB;IAC3B,sEAAsE;IACtE,eAAe,EAAE;QACf,OAAO;YACL;;;OAGC,GACD,aAAa;YACb,cAAc;QAChB;IACF,EACE,oDAAoD;KACnD,UAAU,CAAC,OAAO,EAAE,GAAG,EAAE;QACxB,8CAA8C;QAC9C,MAAM,EAAC,IAAI,EAAC,GAAG,MAAM,IAAA,oKAAY;QAEjC,oDAAoD;QACpD,IAAI,CAAC,MAAM,MAAM,IAAI,8KAAgB,CAAC;QAEtC,4EAA4E;QAC5E,OAAO;YAAE,QAAQ,KAAK,EAAE;QAAC;IAC3B,GACC,gBAAgB,CAAC,OAAO,EAAE,QAAQ,EAAE,IAAI,EAAE;QACzC,6CAA6C;QAC7C,QAAQ,GAAG,CAAC,+BAA+B,SAAS,MAAM;QAE1D,QAAQ,GAAG,CAAC,YAAY,KAAK,MAAM;QAEnC,4FAA4F;QAC5F,OAAO;YAAE,YAAY,SAAS,MAAM;QAAC;IACvC;IACA,kBAAkB,EAAE;QACpB,mBAAmB;YACjB;;;OAGC,GACD,aAAa;YACb,cAAc;QAChB;IACF,EACE,oDAAoD;KACnD,UAAU,CAAC,OAAO,EAAE,GAAG,EAAE;QACxB,8CAA8C;QAC9C,MAAM,EAAC,IAAI,EAAC,GAAG,MAAM,IAAA,oKAAY;QAEjC,oDAAoD;QACpD,IAAI,CAAC,MAAM,MAAM,IAAI,8KAAgB,CAAC;QAEtC,4EAA4E;QAC5E,OAAO;YAAE,QAAQ,KAAK,EAAE;QAAC;IAC3B,GACC,gBAAgB,CAAC,OAAO,EAAE,QAAQ,EAAE,IAAI,EAAE;QACzC,6CAA6C;QAC7C,QAAQ,GAAG,CAAC,+BAA+B,SAAS,MAAM;QAE1D,QAAQ,GAAG,CAAC,YAAY,KAAK,MAAM;QAEnC,4FAA4F;QAC5F,OAAO;YAAE,YAAY,SAAS,MAAM;QAAC;IACvC;AACJ","debugId":null}},
    {"offset": {"line": 228, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/app/api/uploadthing/route.ts"],"sourcesContent":["import { createRouteHandler } from \"uploadthing/next\";\r\n\r\nimport { ourFileRouter } from \"./core\";\r\n\r\n// Export routes for Next App Router\r\nexport const { GET, POST } = createRouteHandler({\r\n  router: ourFileRouter,\r\n\r\n  // Apply an (optional) custom config:\r\n  // config: { ... },\r\n});\r\n"],"names":[],"mappings":";;;;;;AAAA;AAEA;;;AAGO,MAAM,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,IAAA,oLAAkB,EAAC;IAC9C,QAAQ,oJAAa;AAIvB","debugId":null}}]
}