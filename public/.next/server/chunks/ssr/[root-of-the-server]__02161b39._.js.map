{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 24, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/lib/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\r\n \r\nconst globalForPrisma = globalThis as unknown as { prisma: PrismaClient }\r\n \r\nexport const db = globalForPrisma.prisma || new PrismaClient()\r\n \r\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = db"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAEjB,MAAM,KAAK,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAE5D,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 37, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/app/data/user/sync-user.ts"],"sourcesContent":["// src/app/data/user/sync-user.ts\r\nimport { db } from \"@/lib/db\";\r\nimport { getKindeServerSession } from \"@kinde-oss/kinde-auth-nextjs/server\";\r\n\r\nexport const syncUser = async () => {\r\n  const { getUser } = getKindeServerSession();\r\n  const user = await getUser();\r\n\r\n  if (!user) return null;\r\n\r\n  // Find the existing user in DB\r\n  const existingUser = await db.user.findUnique({\r\n    where: { id: user.id },\r\n  });\r\n\r\n  // If user doesn't exist, skip sync\r\n  if (!existingUser) {\r\n    console.log(\"syncUser: user not found in DB, skipping.\");\r\n    return user;\r\n  }\r\n\r\n  // If user.picture is a valid image and not gravatar, use it\r\n  const imageUrl =\r\n    user.picture && !user.picture.includes(\"gravatar.com\")\r\n      ? user.picture\r\n      : null;\r\n\r\n  // Only update if the image value differs\r\n  if (existingUser.image !== imageUrl) {\r\n    await db.user.update({\r\n      where: { id: user.id },\r\n      data: {\r\n        image: imageUrl, // set to either Google image or null\r\n      },\r\n    });\r\n    console.log(\"syncUser: updated image for\", user.id);\r\n  }\r\n\r\n  return user;\r\n};\r\n"],"names":[],"mappings":"AAAA,iCAAiC;;;;;AACjC;AACA;AAAA;;;AAEO,MAAM,WAAW;IACtB,MAAM,EAAE,OAAO,EAAE,GAAG,IAAA,+QAAqB;IACzC,MAAM,OAAO,MAAM;IAEnB,IAAI,CAAC,MAAM,OAAO;IAElB,+BAA+B;IAC/B,MAAM,eAAe,MAAM,+GAAE,CAAC,IAAI,CAAC,UAAU,CAAC;QAC5C,OAAO;YAAE,IAAI,KAAK,EAAE;QAAC;IACvB;IAEA,mCAAmC;IACnC,IAAI,CAAC,cAAc;QACjB,QAAQ,GAAG,CAAC;QACZ,OAAO;IACT;IAEA,4DAA4D;IAC5D,MAAM,WACJ,KAAK,OAAO,IAAI,CAAC,KAAK,OAAO,CAAC,QAAQ,CAAC,kBACnC,KAAK,OAAO,GACZ;IAEN,yCAAyC;IACzC,IAAI,aAAa,KAAK,KAAK,UAAU;QACnC,MAAM,+GAAE,CAAC,IAAI,CAAC,MAAM,CAAC;YACnB,OAAO;gBAAE,IAAI,KAAK,EAAE;YAAC;YACrB,MAAM;gBACJ,OAAO;YACT;QACF;QACA,QAAQ,GAAG,CAAC,+BAA+B,KAAK,EAAE;IACpD;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/app/data/user/is-user-authenticated.ts"],"sourcesContent":["import { getKindeServerSession } from \"@kinde-oss/kinde-auth-nextjs/server\";\r\nimport { redirect } from \"next/navigation\";\r\nimport { syncUser } from \"./sync-user\";\r\n\r\nexport const userRequired = async () => {\r\n  try {\r\n    const { isAuthenticated, getUser } = getKindeServerSession();\r\n    const isUserAuthenticated = await isAuthenticated();\r\n    if (!isUserAuthenticated) redirect(\"/api/auth/login\");\r\n\r\n   \r\n     const user = await syncUser();\r\n\r\n    return { user, isUserAuthenticated };\r\n  } catch (error) {\r\n    console.error(\"Error in userRequired:\", error);\r\n    redirect(\"/api/auth/login\");\r\n  }\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AAAA;AACA;;;;AAEO,MAAM,eAAe;IAC1B,IAAI;QACF,MAAM,EAAE,eAAe,EAAE,OAAO,EAAE,GAAG,IAAA,+QAAqB;QAC1D,MAAM,sBAAsB,MAAM;QAClC,IAAI,CAAC,qBAAqB,IAAA,iMAAQ,EAAC;QAGlC,MAAM,OAAO,MAAM,IAAA,+IAAQ;QAE5B,OAAO;YAAE;YAAM;QAAoB;IACrC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,IAAA,iMAAQ,EAAC;IACX;AACF","debugId":null}},
    {"offset": {"line": 113, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/app/data/workspace/get-user-workspaces.ts"],"sourcesContent":["import { db } from \"@/lib/db\";\r\nimport { userRequired } from \"../user/is-user-authenticated\";\r\n\r\nexport const getUserWorkspaces = async () => {\r\n    try{\r\n        const { user } = await userRequired();\r\n\r\n        const workspaces = await db.user.findUnique({\r\n            where: {id: user.id},\r\n            include: {\r\n                workspaces: {\r\n                    select: {\r\n                        id: true,\r\n                        userId: true,\r\n                        workspaceId: true,\r\n                        accessLevel: true,\r\n                        createdAt: true,\r\n                        workspace: {select: {name: true}},\r\n                    },\r\n                },\r\n            },\r\n        });\r\n        return {data:workspaces}\r\n    }catch (error) {\r\n        console.log(error)\r\n        return{\r\n            success:false,\r\n            error:true,\r\n            message: \"Failed to fetch workspaces\",\r\n            status: 500,\r\n        };\r\n    }\r\n};"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,MAAM,oBAAoB;IAC7B,IAAG;QACC,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,kKAAY;QAEnC,MAAM,aAAa,MAAM,+GAAE,CAAC,IAAI,CAAC,UAAU,CAAC;YACxC,OAAO;gBAAC,IAAI,KAAK,EAAE;YAAA;YACnB,SAAS;gBACL,YAAY;oBACR,QAAQ;wBACJ,IAAI;wBACJ,QAAQ;wBACR,aAAa;wBACb,aAAa;wBACb,WAAW;wBACX,WAAW;4BAAC,QAAQ;gCAAC,MAAM;4BAAI;wBAAC;oBACpC;gBACJ;YACJ;QACJ;QACA,OAAO;YAAC,MAAK;QAAU;IAC3B,EAAC,OAAO,OAAO;QACX,QAAQ,GAAG,CAAC;QACZ,OAAM;YACF,SAAQ;YACR,OAAM;YACN,SAAS;YACT,QAAQ;QACZ;IACJ;AACJ","debugId":null}},
    {"offset": {"line": 162, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/app/%28protected%29/workspace/page.tsx"],"sourcesContent":["import { getUserWorkspaces } from '@/app/data/workspace/get-user-workspaces'\r\nimport { redirect } from 'next/navigation'\r\n\r\nconst page = async () => {\r\n    const {data} = await getUserWorkspaces();\r\n    //if (!data) return null;\r\n    if (data?.onboardingCompleted && data?.workspaces?.length === 0){\r\n        redirect (\"/create-workspace\");\r\n    }else if(!data?.onboardingCompleted){\r\n        redirect (\"/onboarding\");\r\n    }else{\r\n        redirect(`/workspace/${data?.workspaces[0].workspaceId}`);\r\n    }\r\n};\r\n\r\nexport default page\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;;;AAEA,MAAM,OAAO;IACT,MAAM,EAAC,IAAI,EAAC,GAAG,MAAM,IAAA,0KAAiB;IACtC,yBAAyB;IACzB,IAAI,MAAM,uBAAuB,MAAM,YAAY,WAAW,GAAE;QAC5D,IAAA,iMAAQ,EAAE;IACd,OAAM,IAAG,CAAC,MAAM,qBAAoB;QAChC,IAAA,iMAAQ,EAAE;IACd,OAAK;QACD,IAAA,iMAAQ,EAAC,CAAC,WAAW,EAAE,MAAM,UAAU,CAAC,EAAE,CAAC,aAAa;IAC5D;AACJ;uCAEe","debugId":null}}]
}