{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/components/ui/badge.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport { cva, type VariantProps } from \"class-variance-authority\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst badgeVariants = cva(\r\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default:\r\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\r\n        secondary:\r\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\r\n        destructive:\r\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\r\n        outline: \"text-foreground\",\r\n        OWNER:\"bg-pink-600 text-white\",\r\n        MEMBER:\"bg-blue-600 text-white\",\r\n        VIWER:\"bg-gray-600 text-white\",\r\n        TODO:\"bg-blue-600 text-white\",\r\n        IN_PROGRESS:\"bg-yellow-600 text-white\",\r\n        BACKLOG:\"bg-pink-600 text-white\",\r\n        IN_REVIEW:\"bg-purple-600 text-white\",\r\n        COMPLETED:\"bg-green-600 text-white\",\r\n        BLOCKED:\"bg-red-600 text-white\",\r\n        CRITICAL:\"bg-red-600 text-white\",\r\n        HIGH:\"bg-orange-600 text-white\",\r\n        MEDIUM:\"bg-yellow-600 text-white\",\r\n        LOW:\"bg-blue-600 text-white\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nexport interface BadgeProps\r\n  extends React.HTMLAttributes<HTMLDivElement>,\r\n    VariantProps<typeof badgeVariants> {}\r\n\r\nfunction Badge({ className, variant, ...props }: BadgeProps) {\r\n  return (\r\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\r\n  )\r\n}\r\n\r\nexport { Badge, badgeVariants }\r\n"],"names":[],"mappings":";;;;;;;AACA;AAEA;;;;AAEA,MAAM,gBAAgB,IAAA,0KAAG,EACvB,0KACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,WACE;YACF,aACE;YACF,SAAS;YACT,OAAM;YACN,QAAO;YACP,OAAM;YACN,MAAK;YACL,aAAY;YACZ,SAAQ;YACR,WAAU;YACV,WAAU;YACV,SAAQ;YACR,UAAS;YACT,MAAK;YACL,QAAO;YACP,KAAI;QACN;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAOF,SAAS,MAAM,KAA4C;QAA5C,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,OAAmB,GAA5C;IACb,qBACE,6LAAC;QAAI,WAAW,IAAA,qHAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QAAa,GAAG,KAAK;;;;;;AAExE;KAJS","debugId":null}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/app/actions/workspace.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { cons } from './../../node_modules/effect/src/List';\r\n\r\n\r\nimport { CreateWorkspaceDataType } from \"@/components/workspace/create-workspace-form\"\r\nimport { userRequired } from \"../data/user/is-user-authenticated\"\r\nimport { workspaceSchema } from \"@/lib/schema\"\r\nimport { db } from \"@/lib/db\"\r\nimport { generateInviteCode } from \"@/utils/get-invite-code\"\r\nimport { AccessLevel } from '@prisma/client';\r\nimport { redirect } from 'next/navigation'; \r\n\r\n\r\nexport const createNewWorkspace = async(data : CreateWorkspaceDataType) => {\r\n    try{\r\n    const {user} = await userRequired()\r\n\r\n    const validatedData = workspaceSchema.parse(data)\r\n\r\n    const res = await db.workspace.create({\r\n        data:{\r\n            name: validatedData.name,\r\n            description : validatedData.description,\r\n            ownerId : user.id,\r\n            inviteCode: generateInviteCode(),\r\n            members : {\r\n                create : {\r\n                    userId : user.id,\r\n                    accessLevel : \"OWNER\"\r\n                }\r\n            }\r\n        }\r\n    })\r\n    return {data:res};\r\n    }\r\n    catch(err){\r\n        console.log(err)\r\n        return {\r\n            status: 500,\r\n            message : \"An error occured while creating the workspace\"\r\n        }\r\n\r\n    }\r\n}\r\n\r\nexport const updateWorkspace = async (\r\n  workspaceId: string,\r\n  data:CreateWorkspaceDataType\r\n) => {\r\n  const { user } = await userRequired();\r\n\r\n  const validatedData = workspaceSchema.parse(data);\r\n\r\n  const isUserAMember = await db.workspaceMember.findUnique({\r\n    where: {\r\n      userId_workspaceId: {\r\n        userId: user.id,\r\n        workspaceId: workspaceId,\r\n      },\r\n    },\r\n  });\r\n\r\n  if (!isUserAMember) {\r\n    throw new Error(\"You are not a member of this workspace.\");\r\n  }\r\n\r\n  await db.workspace.update({\r\n    where: { id: workspaceId },\r\n    data: {\r\n      name: validatedData.name,\r\n      description: validatedData.description || \"\",\r\n    },\r\n  });\r\n\r\n  return { success: true };\r\n};\r\n\r\n\r\nexport const resetWorkspaceInviteCode = async (workspaceId: string) => {\r\n  const { user } = await userRequired();\r\n\r\n  const isUserAMember = await db.workspaceMember.findUnique({\r\n    where: {\r\n      userId_workspaceId: {\r\n        userId: user.id,\r\n        workspaceId: workspaceId,\r\n      },\r\n    },\r\n  });\r\n\r\n  if (!isUserAMember) {\r\n    throw new Error(\"You are not a member of this workspace.\");\r\n  }\r\n\r\n  await db.workspace.update({\r\n    where: { id: workspaceId },\r\n    data: {\r\n      inviteCode: generateInviteCode(),\r\n    },\r\n  });\r\n};\r\n\r\n\r\nexport const deleteWorkspace = async (workspaceId: string) => {\r\n  const { user } = await userRequired();\r\n\r\n  const isUserAMember = await db.workspaceMember.findUnique({\r\n    where: {\r\n      userId_workspaceId: {\r\n        userId: user.id,\r\n        workspaceId: workspaceId,\r\n      },\r\n    },\r\n  });\r\n\r\n  if (!isUserAMember) {\r\n    throw new Error(\"You are not a member of this workspace.\");\r\n  }\r\n\r\n  if (isUserAMember && isUserAMember.accessLevel !== AccessLevel.OWNER)\r\n  {\r\n    throw new Error(\"only an owner can delete the workspace\");\r\n  }\r\n\r\n  await db.workspace.delete({\r\n    where: { id: workspaceId },\r\n   \r\n  });\r\n\r\n  redirect(\"/workspace\");\r\n};\r\n\r\nexport const getWorkspaceStats = async (workspaceId: string) => {\r\n  try {\r\n    const { user } = await userRequired();\r\n\r\n    // Check if user is a member of the workspace\r\n    const isUserAMember = await db.workspaceMember.findUnique({\r\n      where: {\r\n        userId_workspaceId: {\r\n          userId: user.id,\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!isUserAMember) {\r\n      throw new Error(\"You are not a member of this workspace.\");\r\n    }\r\n\r\n    // Get task stats\r\n    const taskStats = await db.task.groupBy({\r\n      by: ['status'],\r\n      where: {\r\n        project: {\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n      _count: {\r\n        id: true,\r\n      },\r\n    });\r\n\r\n    // Get total tasks\r\n    const totalTasks = await db.task.count({\r\n      where: {\r\n        project: {\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n    });\r\n\r\n    // Get total members\r\n    const totalMembers = await db.workspaceMember.count({\r\n      where: { workspaceId },\r\n    });\r\n\r\n    // Get total projects\r\n    const totalProjects = await db.project.count({\r\n      where: { workspaceId },\r\n    });\r\n\r\n    // Get overdue tasks\r\n    const tasksOverdue = await db.task.count({\r\n      where: {\r\n        project: {\r\n          workspaceId: workspaceId,\r\n        },\r\n        dueDate: {\r\n          lt: new Date(),\r\n        },\r\n        status: {\r\n          notIn: ['COMPLETED'],\r\n        },\r\n      },\r\n    });\r\n\r\n    // Process task stats\r\n    const statsMap = taskStats.reduce((acc, stat) => {\r\n      acc[stat.status] = stat._count.id;\r\n      return acc;\r\n    }, {} as Record<string, number>);\r\n\r\n    const stats = {\r\n      totalTasks,\r\n      completedTasks: statsMap['COMPLETED'] || 0,\r\n      inProgressTasks: statsMap['IN_PROGRESS'] || 0,\r\n      todoTasks: statsMap['TODO'] || 0,\r\n      backlogTasks: statsMap['BACKLOG'] || 0,\r\n      totalMembers,\r\n      totalProjects,\r\n      tasksOverdue,\r\n    };\r\n\r\n    return {\r\n      success: true,\r\n      data: stats,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching workspace stats:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to fetch workspace stats',\r\n    };\r\n  }\r\n};\r\n\r\nexport const getRecentTasks = async (workspaceId: string, limit: number = 5) => {\r\n  try {\r\n    const { user } = await userRequired();\r\n\r\n    // Check if user is a member of the workspace\r\n    const isUserAMember = await db.workspaceMember.findUnique({\r\n      where: {\r\n        userId_workspaceId: {\r\n          userId: user.id,\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!isUserAMember) {\r\n      throw new Error(\"You are not a member of this workspace.\");\r\n    }\r\n\r\n    const recentTasks = await db.task.findMany({\r\n      where: {\r\n        project: {\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n      orderBy: { updatedAt: 'desc' },\r\n      take: limit,\r\n      include: {\r\n        project: {\r\n          select: {\r\n            name: true,\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      data: recentTasks,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching recent tasks:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to fetch recent tasks',\r\n      data: [],\r\n    };\r\n  }\r\n};\r\n\r\nexport const getWorkspaceInfo = async (workspaceId: string) => {\r\n  try {\r\n    const { user } = await userRequired();\r\n\r\n    // Check if user is a member of the workspace\r\n    const isUserAMember = await db.workspaceMember.findUnique({\r\n      where: {\r\n        userId_workspaceId: {\r\n          userId: user.id,\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!isUserAMember) {\r\n      throw new Error(\"You are not a member of this workspace.\");\r\n    }\r\n\r\n    const workspace = await db.workspace.findUnique({\r\n      where: { id: workspaceId },\r\n      select: {\r\n        id: true,\r\n        name: true,\r\n        description: true,\r\n        ownerId: true,\r\n      },\r\n    });\r\n\r\n    if (!workspace) {\r\n      throw new Error(\"Workspace not found.\");\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      data: workspace,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching workspace info:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to fetch workspace info',\r\n    };\r\n  }\r\n};\r\n\r\nexport const getWorkspaceMembers = async (workspaceId: string) => {\r\n  try {\r\n    const { user } = await userRequired();\r\n\r\n    // Check if user is a member of the workspace\r\n    const isUserAMember = await db.workspaceMember.findUnique({\r\n      where: {\r\n        userId_workspaceId: {\r\n          userId: user.id,\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!isUserAMember) {\r\n      throw new Error(\"You are not a member of this workspace.\");\r\n    }\r\n\r\n    const [members, workspace] = await Promise.all([\r\n      db.workspaceMember.findMany({\r\n        where: { workspaceId },\r\n        include: {\r\n          user: {\r\n            select: {\r\n              id: true,\r\n              name: true,\r\n              email: true,\r\n              image: true,\r\n            },\r\n          },\r\n        },\r\n        orderBy: { createdAt: 'asc' },\r\n      }),\r\n      db.workspace.findUnique({\r\n        where: { id: workspaceId },\r\n        select: {\r\n          id: true,\r\n          name: true,\r\n          inviteCode: true,\r\n          ownerId: true,\r\n        },\r\n      }),\r\n    ]);\r\n\r\n    if (!workspace) {\r\n      throw new Error(\"Workspace not found.\");\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      data: { members, workspace },\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching workspace members:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to fetch workspace members',\r\n    };\r\n  }\r\n};\r\n\r\nexport const inviteUserToWorkspace = async (workspaceId: string, email: string) => {\r\n  try {\r\n    const { user } = await userRequired();\r\n\r\n    // Check if current user is a member with appropriate permissions\r\n    const currentUserMember = await db.workspaceMember.findUnique({\r\n      where: {\r\n        userId_workspaceId: {\r\n          userId: user.id,\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!currentUserMember) {\r\n      throw new Error(\"You are not a member of this workspace.\");\r\n    }\r\n\r\n    // Only owners and members can invite (viewers cannot)\r\n    if (currentUserMember.accessLevel === AccessLevel.VIEWER) {\r\n      throw new Error(\"You don't have permission to invite users.\");\r\n    }\r\n\r\n    // Check if user with this email exists\r\n    const existingUser = await db.user.findUnique({\r\n      where: { email },\r\n    });\r\n\r\n    if (existingUser) {\r\n      // Check if user is already a member\r\n      const existingMember = await db.workspaceMember.findUnique({\r\n        where: {\r\n          userId_workspaceId: {\r\n            userId: existingUser.id,\r\n            workspaceId: workspaceId,\r\n          },\r\n        },\r\n      });\r\n\r\n      if (existingMember) {\r\n        throw new Error(\"User is already a member of this workspace.\");\r\n      }\r\n\r\n      // Add user as a member\r\n      await db.workspaceMember.create({\r\n        data: {\r\n          userId: existingUser.id,\r\n          workspaceId: workspaceId,\r\n          accessLevel: AccessLevel.MEMBER,\r\n        },\r\n      });\r\n\r\n      return {\r\n        success: true,\r\n        message: \"User added to workspace successfully.\",\r\n      };\r\n    } else {\r\n      // For now, we'll just return success for non-existing users\r\n      // In a real app, you'd send an email invitation\r\n      return {\r\n        success: true,\r\n        message: \"Invitation sent! User will be added when they sign up.\",\r\n      };\r\n    }\r\n  } catch (error) {\r\n    console.error('Error inviting user:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to invite user',\r\n    };\r\n  }\r\n};\r\n\r\nexport const removeWorkspaceMember = async (workspaceId: string, memberId: string) => {\r\n  try {\r\n    const { user } = await userRequired();\r\n\r\n    // Check if current user is the workspace owner\r\n    const workspace = await db.workspace.findUnique({\r\n      where: { id: workspaceId },\r\n      select: { ownerId: true },\r\n    });\r\n\r\n    if (!workspace) {\r\n      throw new Error(\"Workspace not found.\");\r\n    }\r\n\r\n    if (workspace.ownerId !== user.id) {\r\n      throw new Error(\"Only the workspace owner can remove members.\");\r\n    }\r\n\r\n    // Get the member to remove\r\n    const memberToRemove = await db.workspaceMember.findUnique({\r\n      where: { id: memberId },\r\n    });\r\n\r\n    if (!memberToRemove) {\r\n      throw new Error(\"Member not found.\");\r\n    }\r\n\r\n    if (memberToRemove.workspaceId !== workspaceId) {\r\n      throw new Error(\"Member does not belong to this workspace.\");\r\n    }\r\n\r\n    // Cannot remove the owner\r\n    if (memberToRemove.accessLevel === AccessLevel.OWNER) {\r\n      throw new Error(\"Cannot remove the workspace owner.\");\r\n    }\r\n\r\n    // Remove the member\r\n    await db.workspaceMember.delete({\r\n      where: { id: memberId },\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      message: \"Member removed successfully.\",\r\n    };\r\n  } catch (error) {\r\n    console.error('Error removing member:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to remove member',\r\n    };\r\n  }\r\n};\r\n\r\nexport const updateMemberRole = async (workspaceId: string, memberId: string, newRole: AccessLevel) => {\r\n  try {\r\n    const { user } = await userRequired();\r\n\r\n    // Check if current user is the workspace owner\r\n    const workspace = await db.workspace.findUnique({\r\n      where: { id: workspaceId },\r\n      select: { ownerId: true },\r\n    });\r\n\r\n    if (!workspace) {\r\n      throw new Error(\"Workspace not found.\");\r\n    }\r\n\r\n    if (workspace.ownerId !== user.id) {\r\n      throw new Error(\"Only the workspace owner can change member roles.\");\r\n    }\r\n\r\n    // Get the member to update\r\n    const memberToUpdate = await db.workspaceMember.findUnique({\r\n      where: { id: memberId },\r\n    });\r\n\r\n    if (!memberToUpdate) {\r\n      throw new Error(\"Member not found.\");\r\n    }\r\n\r\n    if (memberToUpdate.workspaceId !== workspaceId) {\r\n      throw new Error(\"Member does not belong to this workspace.\");\r\n    }\r\n\r\n    // Cannot change the owner's role\r\n    if (memberToUpdate.accessLevel === AccessLevel.OWNER) {\r\n      throw new Error(\"Cannot change the workspace owner's role.\");\r\n    }\r\n\r\n    // Cannot make someone an owner (there can only be one owner)\r\n    if (newRole === AccessLevel.OWNER) {\r\n      throw new Error(\"Cannot assign owner role to another member.\");\r\n    }\r\n\r\n    // Update the member's role\r\n    await db.workspaceMember.update({\r\n      where: { id: memberId },\r\n      data: { accessLevel: newRole },\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      message: \"Member role updated successfully.\",\r\n    };\r\n  } catch (error) {\r\n    console.error('Error updating member role:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to update member role',\r\n    };\r\n  }\r\n};\r\n\r\n"],"names":[],"mappings":";;;;;;;IAqIa,oBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA","debugId":null}},
    {"offset": {"line": 81, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/app/actions/workspace.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { cons } from './../../node_modules/effect/src/List';\r\n\r\n\r\nimport { CreateWorkspaceDataType } from \"@/components/workspace/create-workspace-form\"\r\nimport { userRequired } from \"../data/user/is-user-authenticated\"\r\nimport { workspaceSchema } from \"@/lib/schema\"\r\nimport { db } from \"@/lib/db\"\r\nimport { generateInviteCode } from \"@/utils/get-invite-code\"\r\nimport { AccessLevel } from '@prisma/client';\r\nimport { redirect } from 'next/navigation'; \r\n\r\n\r\nexport const createNewWorkspace = async(data : CreateWorkspaceDataType) => {\r\n    try{\r\n    const {user} = await userRequired()\r\n\r\n    const validatedData = workspaceSchema.parse(data)\r\n\r\n    const res = await db.workspace.create({\r\n        data:{\r\n            name: validatedData.name,\r\n            description : validatedData.description,\r\n            ownerId : user.id,\r\n            inviteCode: generateInviteCode(),\r\n            members : {\r\n                create : {\r\n                    userId : user.id,\r\n                    accessLevel : \"OWNER\"\r\n                }\r\n            }\r\n        }\r\n    })\r\n    return {data:res};\r\n    }\r\n    catch(err){\r\n        console.log(err)\r\n        return {\r\n            status: 500,\r\n            message : \"An error occured while creating the workspace\"\r\n        }\r\n\r\n    }\r\n}\r\n\r\nexport const updateWorkspace = async (\r\n  workspaceId: string,\r\n  data:CreateWorkspaceDataType\r\n) => {\r\n  const { user } = await userRequired();\r\n\r\n  const validatedData = workspaceSchema.parse(data);\r\n\r\n  const isUserAMember = await db.workspaceMember.findUnique({\r\n    where: {\r\n      userId_workspaceId: {\r\n        userId: user.id,\r\n        workspaceId: workspaceId,\r\n      },\r\n    },\r\n  });\r\n\r\n  if (!isUserAMember) {\r\n    throw new Error(\"You are not a member of this workspace.\");\r\n  }\r\n\r\n  await db.workspace.update({\r\n    where: { id: workspaceId },\r\n    data: {\r\n      name: validatedData.name,\r\n      description: validatedData.description || \"\",\r\n    },\r\n  });\r\n\r\n  return { success: true };\r\n};\r\n\r\n\r\nexport const resetWorkspaceInviteCode = async (workspaceId: string) => {\r\n  const { user } = await userRequired();\r\n\r\n  const isUserAMember = await db.workspaceMember.findUnique({\r\n    where: {\r\n      userId_workspaceId: {\r\n        userId: user.id,\r\n        workspaceId: workspaceId,\r\n      },\r\n    },\r\n  });\r\n\r\n  if (!isUserAMember) {\r\n    throw new Error(\"You are not a member of this workspace.\");\r\n  }\r\n\r\n  await db.workspace.update({\r\n    where: { id: workspaceId },\r\n    data: {\r\n      inviteCode: generateInviteCode(),\r\n    },\r\n  });\r\n};\r\n\r\n\r\nexport const deleteWorkspace = async (workspaceId: string) => {\r\n  const { user } = await userRequired();\r\n\r\n  const isUserAMember = await db.workspaceMember.findUnique({\r\n    where: {\r\n      userId_workspaceId: {\r\n        userId: user.id,\r\n        workspaceId: workspaceId,\r\n      },\r\n    },\r\n  });\r\n\r\n  if (!isUserAMember) {\r\n    throw new Error(\"You are not a member of this workspace.\");\r\n  }\r\n\r\n  if (isUserAMember && isUserAMember.accessLevel !== AccessLevel.OWNER)\r\n  {\r\n    throw new Error(\"only an owner can delete the workspace\");\r\n  }\r\n\r\n  await db.workspace.delete({\r\n    where: { id: workspaceId },\r\n   \r\n  });\r\n\r\n  redirect(\"/workspace\");\r\n};\r\n\r\nexport const getWorkspaceStats = async (workspaceId: string) => {\r\n  try {\r\n    const { user } = await userRequired();\r\n\r\n    // Check if user is a member of the workspace\r\n    const isUserAMember = await db.workspaceMember.findUnique({\r\n      where: {\r\n        userId_workspaceId: {\r\n          userId: user.id,\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!isUserAMember) {\r\n      throw new Error(\"You are not a member of this workspace.\");\r\n    }\r\n\r\n    // Get task stats\r\n    const taskStats = await db.task.groupBy({\r\n      by: ['status'],\r\n      where: {\r\n        project: {\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n      _count: {\r\n        id: true,\r\n      },\r\n    });\r\n\r\n    // Get total tasks\r\n    const totalTasks = await db.task.count({\r\n      where: {\r\n        project: {\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n    });\r\n\r\n    // Get total members\r\n    const totalMembers = await db.workspaceMember.count({\r\n      where: { workspaceId },\r\n    });\r\n\r\n    // Get total projects\r\n    const totalProjects = await db.project.count({\r\n      where: { workspaceId },\r\n    });\r\n\r\n    // Get overdue tasks\r\n    const tasksOverdue = await db.task.count({\r\n      where: {\r\n        project: {\r\n          workspaceId: workspaceId,\r\n        },\r\n        dueDate: {\r\n          lt: new Date(),\r\n        },\r\n        status: {\r\n          notIn: ['COMPLETED'],\r\n        },\r\n      },\r\n    });\r\n\r\n    // Process task stats\r\n    const statsMap = taskStats.reduce((acc, stat) => {\r\n      acc[stat.status] = stat._count.id;\r\n      return acc;\r\n    }, {} as Record<string, number>);\r\n\r\n    const stats = {\r\n      totalTasks,\r\n      completedTasks: statsMap['COMPLETED'] || 0,\r\n      inProgressTasks: statsMap['IN_PROGRESS'] || 0,\r\n      todoTasks: statsMap['TODO'] || 0,\r\n      backlogTasks: statsMap['BACKLOG'] || 0,\r\n      totalMembers,\r\n      totalProjects,\r\n      tasksOverdue,\r\n    };\r\n\r\n    return {\r\n      success: true,\r\n      data: stats,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching workspace stats:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to fetch workspace stats',\r\n    };\r\n  }\r\n};\r\n\r\nexport const getRecentTasks = async (workspaceId: string, limit: number = 5) => {\r\n  try {\r\n    const { user } = await userRequired();\r\n\r\n    // Check if user is a member of the workspace\r\n    const isUserAMember = await db.workspaceMember.findUnique({\r\n      where: {\r\n        userId_workspaceId: {\r\n          userId: user.id,\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!isUserAMember) {\r\n      throw new Error(\"You are not a member of this workspace.\");\r\n    }\r\n\r\n    const recentTasks = await db.task.findMany({\r\n      where: {\r\n        project: {\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n      orderBy: { updatedAt: 'desc' },\r\n      take: limit,\r\n      include: {\r\n        project: {\r\n          select: {\r\n            name: true,\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      data: recentTasks,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching recent tasks:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to fetch recent tasks',\r\n      data: [],\r\n    };\r\n  }\r\n};\r\n\r\nexport const getWorkspaceInfo = async (workspaceId: string) => {\r\n  try {\r\n    const { user } = await userRequired();\r\n\r\n    // Check if user is a member of the workspace\r\n    const isUserAMember = await db.workspaceMember.findUnique({\r\n      where: {\r\n        userId_workspaceId: {\r\n          userId: user.id,\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!isUserAMember) {\r\n      throw new Error(\"You are not a member of this workspace.\");\r\n    }\r\n\r\n    const workspace = await db.workspace.findUnique({\r\n      where: { id: workspaceId },\r\n      select: {\r\n        id: true,\r\n        name: true,\r\n        description: true,\r\n        ownerId: true,\r\n      },\r\n    });\r\n\r\n    if (!workspace) {\r\n      throw new Error(\"Workspace not found.\");\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      data: workspace,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching workspace info:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to fetch workspace info',\r\n    };\r\n  }\r\n};\r\n\r\nexport const getWorkspaceMembers = async (workspaceId: string) => {\r\n  try {\r\n    const { user } = await userRequired();\r\n\r\n    // Check if user is a member of the workspace\r\n    const isUserAMember = await db.workspaceMember.findUnique({\r\n      where: {\r\n        userId_workspaceId: {\r\n          userId: user.id,\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!isUserAMember) {\r\n      throw new Error(\"You are not a member of this workspace.\");\r\n    }\r\n\r\n    const [members, workspace] = await Promise.all([\r\n      db.workspaceMember.findMany({\r\n        where: { workspaceId },\r\n        include: {\r\n          user: {\r\n            select: {\r\n              id: true,\r\n              name: true,\r\n              email: true,\r\n              image: true,\r\n            },\r\n          },\r\n        },\r\n        orderBy: { createdAt: 'asc' },\r\n      }),\r\n      db.workspace.findUnique({\r\n        where: { id: workspaceId },\r\n        select: {\r\n          id: true,\r\n          name: true,\r\n          inviteCode: true,\r\n          ownerId: true,\r\n        },\r\n      }),\r\n    ]);\r\n\r\n    if (!workspace) {\r\n      throw new Error(\"Workspace not found.\");\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      data: { members, workspace },\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching workspace members:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to fetch workspace members',\r\n    };\r\n  }\r\n};\r\n\r\nexport const inviteUserToWorkspace = async (workspaceId: string, email: string) => {\r\n  try {\r\n    const { user } = await userRequired();\r\n\r\n    // Check if current user is a member with appropriate permissions\r\n    const currentUserMember = await db.workspaceMember.findUnique({\r\n      where: {\r\n        userId_workspaceId: {\r\n          userId: user.id,\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!currentUserMember) {\r\n      throw new Error(\"You are not a member of this workspace.\");\r\n    }\r\n\r\n    // Only owners and members can invite (viewers cannot)\r\n    if (currentUserMember.accessLevel === AccessLevel.VIEWER) {\r\n      throw new Error(\"You don't have permission to invite users.\");\r\n    }\r\n\r\n    // Check if user with this email exists\r\n    const existingUser = await db.user.findUnique({\r\n      where: { email },\r\n    });\r\n\r\n    if (existingUser) {\r\n      // Check if user is already a member\r\n      const existingMember = await db.workspaceMember.findUnique({\r\n        where: {\r\n          userId_workspaceId: {\r\n            userId: existingUser.id,\r\n            workspaceId: workspaceId,\r\n          },\r\n        },\r\n      });\r\n\r\n      if (existingMember) {\r\n        throw new Error(\"User is already a member of this workspace.\");\r\n      }\r\n\r\n      // Add user as a member\r\n      await db.workspaceMember.create({\r\n        data: {\r\n          userId: existingUser.id,\r\n          workspaceId: workspaceId,\r\n          accessLevel: AccessLevel.MEMBER,\r\n        },\r\n      });\r\n\r\n      return {\r\n        success: true,\r\n        message: \"User added to workspace successfully.\",\r\n      };\r\n    } else {\r\n      // For now, we'll just return success for non-existing users\r\n      // In a real app, you'd send an email invitation\r\n      return {\r\n        success: true,\r\n        message: \"Invitation sent! User will be added when they sign up.\",\r\n      };\r\n    }\r\n  } catch (error) {\r\n    console.error('Error inviting user:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to invite user',\r\n    };\r\n  }\r\n};\r\n\r\nexport const removeWorkspaceMember = async (workspaceId: string, memberId: string) => {\r\n  try {\r\n    const { user } = await userRequired();\r\n\r\n    // Check if current user is the workspace owner\r\n    const workspace = await db.workspace.findUnique({\r\n      where: { id: workspaceId },\r\n      select: { ownerId: true },\r\n    });\r\n\r\n    if (!workspace) {\r\n      throw new Error(\"Workspace not found.\");\r\n    }\r\n\r\n    if (workspace.ownerId !== user.id) {\r\n      throw new Error(\"Only the workspace owner can remove members.\");\r\n    }\r\n\r\n    // Get the member to remove\r\n    const memberToRemove = await db.workspaceMember.findUnique({\r\n      where: { id: memberId },\r\n    });\r\n\r\n    if (!memberToRemove) {\r\n      throw new Error(\"Member not found.\");\r\n    }\r\n\r\n    if (memberToRemove.workspaceId !== workspaceId) {\r\n      throw new Error(\"Member does not belong to this workspace.\");\r\n    }\r\n\r\n    // Cannot remove the owner\r\n    if (memberToRemove.accessLevel === AccessLevel.OWNER) {\r\n      throw new Error(\"Cannot remove the workspace owner.\");\r\n    }\r\n\r\n    // Remove the member\r\n    await db.workspaceMember.delete({\r\n      where: { id: memberId },\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      message: \"Member removed successfully.\",\r\n    };\r\n  } catch (error) {\r\n    console.error('Error removing member:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to remove member',\r\n    };\r\n  }\r\n};\r\n\r\nexport const updateMemberRole = async (workspaceId: string, memberId: string, newRole: AccessLevel) => {\r\n  try {\r\n    const { user } = await userRequired();\r\n\r\n    // Check if current user is the workspace owner\r\n    const workspace = await db.workspace.findUnique({\r\n      where: { id: workspaceId },\r\n      select: { ownerId: true },\r\n    });\r\n\r\n    if (!workspace) {\r\n      throw new Error(\"Workspace not found.\");\r\n    }\r\n\r\n    if (workspace.ownerId !== user.id) {\r\n      throw new Error(\"Only the workspace owner can change member roles.\");\r\n    }\r\n\r\n    // Get the member to update\r\n    const memberToUpdate = await db.workspaceMember.findUnique({\r\n      where: { id: memberId },\r\n    });\r\n\r\n    if (!memberToUpdate) {\r\n      throw new Error(\"Member not found.\");\r\n    }\r\n\r\n    if (memberToUpdate.workspaceId !== workspaceId) {\r\n      throw new Error(\"Member does not belong to this workspace.\");\r\n    }\r\n\r\n    // Cannot change the owner's role\r\n    if (memberToUpdate.accessLevel === AccessLevel.OWNER) {\r\n      throw new Error(\"Cannot change the workspace owner's role.\");\r\n    }\r\n\r\n    // Cannot make someone an owner (there can only be one owner)\r\n    if (newRole === AccessLevel.OWNER) {\r\n      throw new Error(\"Cannot assign owner role to another member.\");\r\n    }\r\n\r\n    // Update the member's role\r\n    await db.workspaceMember.update({\r\n      where: { id: memberId },\r\n      data: { accessLevel: newRole },\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      message: \"Member role updated successfully.\",\r\n    };\r\n  } catch (error) {\r\n    console.error('Error updating member role:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to update member role',\r\n    };\r\n  }\r\n};\r\n\r\n"],"names":[],"mappings":";;;;;;;IAoOa,iBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA","debugId":null}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/app/actions/workspace.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { cons } from './../../node_modules/effect/src/List';\r\n\r\n\r\nimport { CreateWorkspaceDataType } from \"@/components/workspace/create-workspace-form\"\r\nimport { userRequired } from \"../data/user/is-user-authenticated\"\r\nimport { workspaceSchema } from \"@/lib/schema\"\r\nimport { db } from \"@/lib/db\"\r\nimport { generateInviteCode } from \"@/utils/get-invite-code\"\r\nimport { AccessLevel } from '@prisma/client';\r\nimport { redirect } from 'next/navigation'; \r\n\r\n\r\nexport const createNewWorkspace = async(data : CreateWorkspaceDataType) => {\r\n    try{\r\n    const {user} = await userRequired()\r\n\r\n    const validatedData = workspaceSchema.parse(data)\r\n\r\n    const res = await db.workspace.create({\r\n        data:{\r\n            name: validatedData.name,\r\n            description : validatedData.description,\r\n            ownerId : user.id,\r\n            inviteCode: generateInviteCode(),\r\n            members : {\r\n                create : {\r\n                    userId : user.id,\r\n                    accessLevel : \"OWNER\"\r\n                }\r\n            }\r\n        }\r\n    })\r\n    return {data:res};\r\n    }\r\n    catch(err){\r\n        console.log(err)\r\n        return {\r\n            status: 500,\r\n            message : \"An error occured while creating the workspace\"\r\n        }\r\n\r\n    }\r\n}\r\n\r\nexport const updateWorkspace = async (\r\n  workspaceId: string,\r\n  data:CreateWorkspaceDataType\r\n) => {\r\n  const { user } = await userRequired();\r\n\r\n  const validatedData = workspaceSchema.parse(data);\r\n\r\n  const isUserAMember = await db.workspaceMember.findUnique({\r\n    where: {\r\n      userId_workspaceId: {\r\n        userId: user.id,\r\n        workspaceId: workspaceId,\r\n      },\r\n    },\r\n  });\r\n\r\n  if (!isUserAMember) {\r\n    throw new Error(\"You are not a member of this workspace.\");\r\n  }\r\n\r\n  await db.workspace.update({\r\n    where: { id: workspaceId },\r\n    data: {\r\n      name: validatedData.name,\r\n      description: validatedData.description || \"\",\r\n    },\r\n  });\r\n\r\n  return { success: true };\r\n};\r\n\r\n\r\nexport const resetWorkspaceInviteCode = async (workspaceId: string) => {\r\n  const { user } = await userRequired();\r\n\r\n  const isUserAMember = await db.workspaceMember.findUnique({\r\n    where: {\r\n      userId_workspaceId: {\r\n        userId: user.id,\r\n        workspaceId: workspaceId,\r\n      },\r\n    },\r\n  });\r\n\r\n  if (!isUserAMember) {\r\n    throw new Error(\"You are not a member of this workspace.\");\r\n  }\r\n\r\n  await db.workspace.update({\r\n    where: { id: workspaceId },\r\n    data: {\r\n      inviteCode: generateInviteCode(),\r\n    },\r\n  });\r\n};\r\n\r\n\r\nexport const deleteWorkspace = async (workspaceId: string) => {\r\n  const { user } = await userRequired();\r\n\r\n  const isUserAMember = await db.workspaceMember.findUnique({\r\n    where: {\r\n      userId_workspaceId: {\r\n        userId: user.id,\r\n        workspaceId: workspaceId,\r\n      },\r\n    },\r\n  });\r\n\r\n  if (!isUserAMember) {\r\n    throw new Error(\"You are not a member of this workspace.\");\r\n  }\r\n\r\n  if (isUserAMember && isUserAMember.accessLevel !== AccessLevel.OWNER)\r\n  {\r\n    throw new Error(\"only an owner can delete the workspace\");\r\n  }\r\n\r\n  await db.workspace.delete({\r\n    where: { id: workspaceId },\r\n   \r\n  });\r\n\r\n  redirect(\"/workspace\");\r\n};\r\n\r\nexport const getWorkspaceStats = async (workspaceId: string) => {\r\n  try {\r\n    const { user } = await userRequired();\r\n\r\n    // Check if user is a member of the workspace\r\n    const isUserAMember = await db.workspaceMember.findUnique({\r\n      where: {\r\n        userId_workspaceId: {\r\n          userId: user.id,\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!isUserAMember) {\r\n      throw new Error(\"You are not a member of this workspace.\");\r\n    }\r\n\r\n    // Get task stats\r\n    const taskStats = await db.task.groupBy({\r\n      by: ['status'],\r\n      where: {\r\n        project: {\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n      _count: {\r\n        id: true,\r\n      },\r\n    });\r\n\r\n    // Get total tasks\r\n    const totalTasks = await db.task.count({\r\n      where: {\r\n        project: {\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n    });\r\n\r\n    // Get total members\r\n    const totalMembers = await db.workspaceMember.count({\r\n      where: { workspaceId },\r\n    });\r\n\r\n    // Get total projects\r\n    const totalProjects = await db.project.count({\r\n      where: { workspaceId },\r\n    });\r\n\r\n    // Get overdue tasks\r\n    const tasksOverdue = await db.task.count({\r\n      where: {\r\n        project: {\r\n          workspaceId: workspaceId,\r\n        },\r\n        dueDate: {\r\n          lt: new Date(),\r\n        },\r\n        status: {\r\n          notIn: ['COMPLETED'],\r\n        },\r\n      },\r\n    });\r\n\r\n    // Process task stats\r\n    const statsMap = taskStats.reduce((acc, stat) => {\r\n      acc[stat.status] = stat._count.id;\r\n      return acc;\r\n    }, {} as Record<string, number>);\r\n\r\n    const stats = {\r\n      totalTasks,\r\n      completedTasks: statsMap['COMPLETED'] || 0,\r\n      inProgressTasks: statsMap['IN_PROGRESS'] || 0,\r\n      todoTasks: statsMap['TODO'] || 0,\r\n      backlogTasks: statsMap['BACKLOG'] || 0,\r\n      totalMembers,\r\n      totalProjects,\r\n      tasksOverdue,\r\n    };\r\n\r\n    return {\r\n      success: true,\r\n      data: stats,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching workspace stats:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to fetch workspace stats',\r\n    };\r\n  }\r\n};\r\n\r\nexport const getRecentTasks = async (workspaceId: string, limit: number = 5) => {\r\n  try {\r\n    const { user } = await userRequired();\r\n\r\n    // Check if user is a member of the workspace\r\n    const isUserAMember = await db.workspaceMember.findUnique({\r\n      where: {\r\n        userId_workspaceId: {\r\n          userId: user.id,\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!isUserAMember) {\r\n      throw new Error(\"You are not a member of this workspace.\");\r\n    }\r\n\r\n    const recentTasks = await db.task.findMany({\r\n      where: {\r\n        project: {\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n      orderBy: { updatedAt: 'desc' },\r\n      take: limit,\r\n      include: {\r\n        project: {\r\n          select: {\r\n            name: true,\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      data: recentTasks,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching recent tasks:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to fetch recent tasks',\r\n      data: [],\r\n    };\r\n  }\r\n};\r\n\r\nexport const getWorkspaceInfo = async (workspaceId: string) => {\r\n  try {\r\n    const { user } = await userRequired();\r\n\r\n    // Check if user is a member of the workspace\r\n    const isUserAMember = await db.workspaceMember.findUnique({\r\n      where: {\r\n        userId_workspaceId: {\r\n          userId: user.id,\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!isUserAMember) {\r\n      throw new Error(\"You are not a member of this workspace.\");\r\n    }\r\n\r\n    const workspace = await db.workspace.findUnique({\r\n      where: { id: workspaceId },\r\n      select: {\r\n        id: true,\r\n        name: true,\r\n        description: true,\r\n        ownerId: true,\r\n      },\r\n    });\r\n\r\n    if (!workspace) {\r\n      throw new Error(\"Workspace not found.\");\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      data: workspace,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching workspace info:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to fetch workspace info',\r\n    };\r\n  }\r\n};\r\n\r\nexport const getWorkspaceMembers = async (workspaceId: string) => {\r\n  try {\r\n    const { user } = await userRequired();\r\n\r\n    // Check if user is a member of the workspace\r\n    const isUserAMember = await db.workspaceMember.findUnique({\r\n      where: {\r\n        userId_workspaceId: {\r\n          userId: user.id,\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!isUserAMember) {\r\n      throw new Error(\"You are not a member of this workspace.\");\r\n    }\r\n\r\n    const [members, workspace] = await Promise.all([\r\n      db.workspaceMember.findMany({\r\n        where: { workspaceId },\r\n        include: {\r\n          user: {\r\n            select: {\r\n              id: true,\r\n              name: true,\r\n              email: true,\r\n              image: true,\r\n            },\r\n          },\r\n        },\r\n        orderBy: { createdAt: 'asc' },\r\n      }),\r\n      db.workspace.findUnique({\r\n        where: { id: workspaceId },\r\n        select: {\r\n          id: true,\r\n          name: true,\r\n          inviteCode: true,\r\n          ownerId: true,\r\n        },\r\n      }),\r\n    ]);\r\n\r\n    if (!workspace) {\r\n      throw new Error(\"Workspace not found.\");\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      data: { members, workspace },\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching workspace members:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to fetch workspace members',\r\n    };\r\n  }\r\n};\r\n\r\nexport const inviteUserToWorkspace = async (workspaceId: string, email: string) => {\r\n  try {\r\n    const { user } = await userRequired();\r\n\r\n    // Check if current user is a member with appropriate permissions\r\n    const currentUserMember = await db.workspaceMember.findUnique({\r\n      where: {\r\n        userId_workspaceId: {\r\n          userId: user.id,\r\n          workspaceId: workspaceId,\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!currentUserMember) {\r\n      throw new Error(\"You are not a member of this workspace.\");\r\n    }\r\n\r\n    // Only owners and members can invite (viewers cannot)\r\n    if (currentUserMember.accessLevel === AccessLevel.VIEWER) {\r\n      throw new Error(\"You don't have permission to invite users.\");\r\n    }\r\n\r\n    // Check if user with this email exists\r\n    const existingUser = await db.user.findUnique({\r\n      where: { email },\r\n    });\r\n\r\n    if (existingUser) {\r\n      // Check if user is already a member\r\n      const existingMember = await db.workspaceMember.findUnique({\r\n        where: {\r\n          userId_workspaceId: {\r\n            userId: existingUser.id,\r\n            workspaceId: workspaceId,\r\n          },\r\n        },\r\n      });\r\n\r\n      if (existingMember) {\r\n        throw new Error(\"User is already a member of this workspace.\");\r\n      }\r\n\r\n      // Add user as a member\r\n      await db.workspaceMember.create({\r\n        data: {\r\n          userId: existingUser.id,\r\n          workspaceId: workspaceId,\r\n          accessLevel: AccessLevel.MEMBER,\r\n        },\r\n      });\r\n\r\n      return {\r\n        success: true,\r\n        message: \"User added to workspace successfully.\",\r\n      };\r\n    } else {\r\n      // For now, we'll just return success for non-existing users\r\n      // In a real app, you'd send an email invitation\r\n      return {\r\n        success: true,\r\n        message: \"Invitation sent! User will be added when they sign up.\",\r\n      };\r\n    }\r\n  } catch (error) {\r\n    console.error('Error inviting user:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to invite user',\r\n    };\r\n  }\r\n};\r\n\r\nexport const removeWorkspaceMember = async (workspaceId: string, memberId: string) => {\r\n  try {\r\n    const { user } = await userRequired();\r\n\r\n    // Check if current user is the workspace owner\r\n    const workspace = await db.workspace.findUnique({\r\n      where: { id: workspaceId },\r\n      select: { ownerId: true },\r\n    });\r\n\r\n    if (!workspace) {\r\n      throw new Error(\"Workspace not found.\");\r\n    }\r\n\r\n    if (workspace.ownerId !== user.id) {\r\n      throw new Error(\"Only the workspace owner can remove members.\");\r\n    }\r\n\r\n    // Get the member to remove\r\n    const memberToRemove = await db.workspaceMember.findUnique({\r\n      where: { id: memberId },\r\n    });\r\n\r\n    if (!memberToRemove) {\r\n      throw new Error(\"Member not found.\");\r\n    }\r\n\r\n    if (memberToRemove.workspaceId !== workspaceId) {\r\n      throw new Error(\"Member does not belong to this workspace.\");\r\n    }\r\n\r\n    // Cannot remove the owner\r\n    if (memberToRemove.accessLevel === AccessLevel.OWNER) {\r\n      throw new Error(\"Cannot remove the workspace owner.\");\r\n    }\r\n\r\n    // Remove the member\r\n    await db.workspaceMember.delete({\r\n      where: { id: memberId },\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      message: \"Member removed successfully.\",\r\n    };\r\n  } catch (error) {\r\n    console.error('Error removing member:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to remove member',\r\n    };\r\n  }\r\n};\r\n\r\nexport const updateMemberRole = async (workspaceId: string, memberId: string, newRole: AccessLevel) => {\r\n  try {\r\n    const { user } = await userRequired();\r\n\r\n    // Check if current user is the workspace owner\r\n    const workspace = await db.workspace.findUnique({\r\n      where: { id: workspaceId },\r\n      select: { ownerId: true },\r\n    });\r\n\r\n    if (!workspace) {\r\n      throw new Error(\"Workspace not found.\");\r\n    }\r\n\r\n    if (workspace.ownerId !== user.id) {\r\n      throw new Error(\"Only the workspace owner can change member roles.\");\r\n    }\r\n\r\n    // Get the member to update\r\n    const memberToUpdate = await db.workspaceMember.findUnique({\r\n      where: { id: memberId },\r\n    });\r\n\r\n    if (!memberToUpdate) {\r\n      throw new Error(\"Member not found.\");\r\n    }\r\n\r\n    if (memberToUpdate.workspaceId !== workspaceId) {\r\n      throw new Error(\"Member does not belong to this workspace.\");\r\n    }\r\n\r\n    // Cannot change the owner's role\r\n    if (memberToUpdate.accessLevel === AccessLevel.OWNER) {\r\n      throw new Error(\"Cannot change the workspace owner's role.\");\r\n    }\r\n\r\n    // Cannot make someone an owner (there can only be one owner)\r\n    if (newRole === AccessLevel.OWNER) {\r\n      throw new Error(\"Cannot assign owner role to another member.\");\r\n    }\r\n\r\n    // Update the member's role\r\n    await db.workspaceMember.update({\r\n      where: { id: memberId },\r\n      data: { accessLevel: newRole },\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      message: \"Member role updated successfully.\",\r\n    };\r\n  } catch (error) {\r\n    console.error('Error updating member role:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to update member role',\r\n    };\r\n  }\r\n};\r\n\r\n"],"names":[],"mappings":";;;;;;;IAqRa,mBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA","debugId":null}},
    {"offset": {"line": 111, "column": 0}, "map": {"version":3,"sources":["file:///D:/840%20G3/7th%20semester/FSPM/Trackly/Trackly/app/%28protected%29/workspace/%5BworkspaceId%5D/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport React, { useEffect, useState } from 'react'\r\nimport { useWorkspaceId } from \"@/hooks/use-workspace-id\"\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { \r\n  CheckSquare, \r\n  Clock, \r\n  Users, \r\n  TrendingUp, \r\n  Plus,\r\n  Calendar,\r\n  Target,\r\n  Activity,\r\n  Loader2\r\n} from \"lucide-react\"\r\nimport Link from \"next/link\"\r\nimport { motion } from \"framer-motion\"\r\nimport { useKindeBrowserClient } from \"@kinde-oss/kinde-auth-nextjs\"\r\nimport { getWorkspaceStats, getRecentTasks, getWorkspaceInfo } from \"@/app/actions/workspace\"\r\n\r\ninterface WorkspaceStats {\r\n  totalTasks: number\r\n  completedTasks: number\r\n  inProgressTasks: number\r\n  todoTasks: number\r\n  backlogTasks: number\r\n  totalMembers: number\r\n  totalProjects: number\r\n  tasksOverdue: number\r\n}\r\n\r\ninterface RecentTask {\r\n  id: string\r\n  title: string // Changed from 'name' to 'title' to match schema\r\n  status: 'TODO' | 'IN_PROGRESS' | 'IN_REVIEW' | 'COMPLETED' | 'BACKLOG' | 'BLOCKED'\r\n  priority: 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL'\r\n  dueDate: string | null\r\n  project: {\r\n    name: string\r\n  } | null\r\n}\r\n\r\ninterface WorkspaceInfo {\r\n  name: string\r\n  imageUrl: string | null\r\n  userId: string\r\n}\r\n\r\nfunction WorkspaceDashboard() {\r\n  const workspaceId = useWorkspaceId()\r\n  const { user } = useKindeBrowserClient()\r\n  const [stats, setStats] = useState<WorkspaceStats | null>(null)\r\n  const [recentTasks, setRecentTasks] = useState<RecentTask[]>([])\r\n  const [workspaceInfo, setWorkspaceInfo] = useState<WorkspaceInfo | null>(null)\r\n  const [loading, setLoading] = useState(true)\r\n  const [error, setError] = useState<string | null>(null)\r\n\r\n  useEffect(() => {\r\n    const fetchWorkspaceData = async () => {\r\n      if (!workspaceId || !user) return\r\n\r\n      try {\r\n        setLoading(true)\r\n        setError(null)\r\n\r\n        // Fetch workspace info, stats, and recent tasks using server actions\r\n        const [workspaceResult, statsResult, tasksResult] = await Promise.all([\r\n          getWorkspaceInfo(workspaceId),\r\n          getWorkspaceStats(workspaceId),\r\n          getRecentTasks(workspaceId, 5)\r\n        ])\r\n\r\n        if (workspaceResult.success && workspaceResult.data) {\r\n          setWorkspaceInfo({\r\n            name: workspaceResult.data.name,\r\n            imageUrl: null, // Schema doesn't have imageUrl field\r\n            userId: workspaceResult.data.ownerId || \"\"\r\n          })\r\n        }\r\n\r\n        if (statsResult.success && statsResult.data) {\r\n          setStats(statsResult.data)\r\n        }\r\n\r\n        if (tasksResult.success && tasksResult.data) {\r\n          setRecentTasks(tasksResult.data)\r\n        }\r\n\r\n      } catch (err) {\r\n        console.error('Error fetching workspace data:', err)\r\n        setError(err instanceof Error ? err.message : 'Failed to load workspace data')\r\n      } finally {\r\n        setLoading(false)\r\n      }\r\n    }\r\n\r\n    fetchWorkspaceData()\r\n  }, [workspaceId, user])\r\n\r\n  const quickActions = [\r\n    { \r\n      label: \"Create Task\", \r\n      icon: Plus, \r\n      href: `/workspace/${workspaceId}/tasks`, \r\n      color: \"bg-blue-500\" \r\n    },\r\n    { \r\n      label: \"View All Tasks\", \r\n      icon: CheckSquare, \r\n      href: `/workspace/${workspaceId}/my-tasks`, \r\n      color: \"bg-green-500\" \r\n    },\r\n    { \r\n      label: \"Team Members\", \r\n      icon: Users, \r\n      href: `/workspace/${workspaceId}/members`, \r\n      color: \"bg-purple-500\" \r\n    },\r\n    { \r\n      label: \"Settings\", \r\n      icon: Target, \r\n      href: `/workspace/${workspaceId}/settings`, \r\n      color: \"bg-orange-500\" \r\n    }\r\n  ]\r\n\r\n  const formatDate = (dateString: string | null) => {\r\n    if (!dateString) return 'No due date'\r\n    \r\n    const date = new Date(dateString)\r\n    const today = new Date()\r\n    const tomorrow = new Date(today)\r\n    tomorrow.setDate(tomorrow.getDate() + 1)\r\n    \r\n    if (date.toDateString() === today.toDateString()) {\r\n      return 'Today'\r\n    } else if (date.toDateString() === tomorrow.toDateString()) {\r\n      return 'Tomorrow'\r\n    } else if (date < today) {\r\n      return 'Overdue'\r\n    } else {\r\n      return date.toLocaleDateString('en-US', { \r\n        month: 'short', \r\n        day: 'numeric' \r\n      })\r\n    }\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-64\">\r\n        <div className=\"flex flex-col items-center gap-2\">\r\n          <Loader2 className=\"h-8 w-8 animate-spin\" />\r\n          <p className=\"text-sm text-muted-foreground\">Loading workspace...</p>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"text-center\">\r\n              <p className=\"text-red-500 mb-4\">Error: {error}</p>\r\n              <Button \r\n                variant=\"outline\" \r\n                onClick={() => window.location.reload()}\r\n              >\r\n                Retry\r\n              </Button>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  if (!stats || !workspaceInfo) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <p className=\"text-center text-muted-foreground\">No workspace data available</p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  const completionRate = stats.totalTasks > 0 \r\n    ? Math.round((stats.completedTasks / stats.totalTasks) * 100) \r\n    : 0\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold\">\r\n            Welcome back, {user?.given_name || 'there'}! \r\n          </h1>\r\n          <p className=\"text-muted-foreground mt-1\">\r\n            Here's what's happening in <span className=\"font-medium\">{workspaceInfo.name}</span> today.\r\n          </p>\r\n        </div>\r\n        <Button asChild>\r\n          <Link href={`/workspace/${workspaceId}/tasks`}>\r\n            <Plus className=\"mr-2 h-4 w-4\" />\r\n            New Task\r\n          </Link>\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Stats Cards */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n        <motion.div\r\n          initial={{ opacity: 0, y: 20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          transition={{ delay: 0.1 }}\r\n        >\r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n              <CardTitle className=\"text-sm font-medium\">Total Tasks</CardTitle>\r\n              <CheckSquare className=\"h-4 w-4 text-muted-foreground\" />\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-2xl font-bold\">{stats.totalTasks}</div>\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                {stats.completedTasks} completed\r\n              </p>\r\n            </CardContent>\r\n          </Card>\r\n        </motion.div>\r\n\r\n        <motion.div\r\n          initial={{ opacity: 0, y: 20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          transition={{ delay: 0.2 }}\r\n        >\r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n              <CardTitle className=\"text-sm font-medium\">In Progress</CardTitle>\r\n              <Clock className=\"h-4 w-4 text-muted-foreground\" />\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-2xl font-bold\">{stats.inProgressTasks}</div>\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                Currently active\r\n              </p>\r\n            </CardContent>\r\n          </Card>\r\n        </motion.div>\r\n\r\n        <motion.div\r\n          initial={{ opacity: 0, y: 20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          transition={{ delay: 0.3 }}\r\n        >\r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n              <CardTitle className=\"text-sm font-medium\">Team Members</CardTitle>\r\n              <Users className=\"h-4 w-4 text-muted-foreground\" />\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-2xl font-bold\">{stats.totalMembers}</div>\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                Active collaborators\r\n              </p>\r\n            </CardContent>\r\n          </Card>\r\n        </motion.div>\r\n\r\n        <motion.div\r\n          initial={{ opacity: 0, y: 20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          transition={{ delay: 0.4 }}\r\n        >\r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n              <CardTitle className=\"text-sm font-medium\">Completion Rate</CardTitle>\r\n              <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-2xl font-bold\">{completionRate}%</div>\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                Overall progress\r\n              </p>\r\n            </CardContent>\r\n          </Card>\r\n        </motion.div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n        {/* Recent Tasks */}\r\n        <motion.div\r\n          initial={{ opacity: 0, x: -20 }}\r\n          animate={{ opacity: 1, x: 0 }}\r\n          transition={{ delay: 0.5 }}\r\n        >\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <Activity className=\"h-5 w-5\" />\r\n                Recent Tasks\r\n              </CardTitle>\r\n              <CardDescription>\r\n                Your latest task activities\r\n              </CardDescription>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-3\">\r\n              {recentTasks.length > 0 ? (\r\n                <>\r\n                  {recentTasks.map((task, index) => (\r\n                    <motion.div\r\n                      key={task.id}\r\n                      initial={{ opacity: 0, y: 10 }}\r\n                      animate={{ opacity: 1, y: 0 }}\r\n                      transition={{ delay: 0.6 + index * 0.1 }}\r\n                      className=\"flex items-center justify-between p-3 rounded-lg border bg-card hover:bg-accent/50 transition-colors cursor-pointer\"\r\n                    >\r\n                      <div className=\"flex-1\">\r\n                        <p className=\"font-medium text-sm\">{task.title}</p>\r\n                        <div className=\"flex items-center gap-2 mt-1\">\r\n                          <Badge variant={task.status} className=\"text-xs\">\r\n                            {task.status.replace('_', ' ')}\r\n                          </Badge>\r\n                          <Badge variant={task.priority} className=\"text-xs\">\r\n                            {task.priority}\r\n                          </Badge>\r\n                          {task.project && (\r\n                            <span className=\"text-xs text-muted-foreground\">\r\n                               {task.project.name}\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"text-xs text-muted-foreground\">\r\n                        {formatDate(task.dueDate)}\r\n                      </div>\r\n                    </motion.div>\r\n                  ))}\r\n                </>\r\n              ) : (\r\n                <div className=\"text-center py-8\">\r\n                  <CheckSquare className=\"h-8 w-8 text-muted-foreground mx-auto mb-2\" />\r\n                  <p className=\"text-muted-foreground\">No tasks yet</p>\r\n                  <p className=\"text-sm text-muted-foreground\">Create your first task to get started</p>\r\n                </div>\r\n              )}\r\n              <Button variant=\"outline\" className=\"w-full mt-4\" asChild>\r\n                <Link href={`/workspace/${workspaceId}/my-tasks`}>\r\n                  View All Tasks\r\n                </Link>\r\n              </Button>\r\n            </CardContent>\r\n          </Card>\r\n        </motion.div>\r\n\r\n        {/* Quick Actions */}\r\n        <motion.div\r\n          initial={{ opacity: 0, x: 20 }}\r\n          animate={{ opacity: 1, x: 0 }}\r\n          transition={{ delay: 0.6 }}\r\n        >\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <Target className=\"h-5 w-5\" />\r\n                Quick Actions\r\n              </CardTitle>\r\n              <CardDescription>\r\n                Common tasks and shortcuts\r\n              </CardDescription>\r\n            </CardHeader>\r\n            <CardContent className=\"grid grid-cols-2 gap-3\">\r\n              {quickActions.map((action, index) => (\r\n                <motion.div\r\n                  key={action.label}\r\n                  whileHover={{ scale: 1.02 }}\r\n                  whileTap={{ scale: 0.98 }}\r\n                >\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    className=\"h-20 flex flex-col gap-2 w-full\"\r\n                    asChild\r\n                  >\r\n                    <Link href={action.href}>\r\n                      <div className={`p-2 rounded-lg ${action.color} bg-opacity-10`}>\r\n                        <action.icon className=\"h-5 w-5\" />\r\n                      </div>\r\n                      <span className=\"text-xs font-medium\">{action.label}</span>\r\n                    </Link>\r\n                  </Button>\r\n                </motion.div>\r\n              ))}\r\n            </CardContent>\r\n          </Card>\r\n        </motion.div>\r\n      </div>\r\n\r\n      {/* Progress Overview */}\r\n      <motion.div\r\n        initial={{ opacity: 0, y: 20 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        transition={{ delay: 0.7 }}\r\n      >\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>Progress Overview</CardTitle>\r\n            <CardDescription>\r\n              Track your workspace progress and productivity\r\n            </CardDescription>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <div className=\"flex justify-between text-sm mb-2\">\r\n                  <span>Task Completion</span>\r\n                  <span>{completionRate}%</span>\r\n                </div>\r\n                <div className=\"w-full bg-secondary rounded-full h-2\">\r\n                  <motion.div\r\n                    className=\"bg-primary h-2 rounded-full\"\r\n                    initial={{ width: 0 }}\r\n                    animate={{ width: `${completionRate}%` }}\r\n                    transition={{ delay: 0.8, duration: 1 }}\r\n                  />\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"grid grid-cols-4 gap-4 pt-4\">\r\n                <div className=\"text-center\">\r\n                  <div className=\"text-2xl font-bold text-green-600\">{stats.completedTasks}</div>\r\n                  <div className=\"text-sm text-muted-foreground\">Completed</div>\r\n                </div>\r\n                <div className=\"text-center\">\r\n                  <div className=\"text-2xl font-bold text-blue-600\">{stats.inProgressTasks}</div>\r\n                  <div className=\"text-sm text-muted-foreground\">In Progress</div>\r\n                </div>\r\n                <div className=\"text-center\">\r\n                  <div className=\"text-2xl font-bold text-yellow-600\">{stats.todoTasks}</div>\r\n                  <div className=\"text-sm text-muted-foreground\">To Do</div>\r\n                </div>\r\n                <div className=\"text-center\">\r\n                  <div className=\"text-2xl font-bold text-red-600\">{stats.tasksOverdue}</div>\r\n                  <div className=\"text-sm text-muted-foreground\">Overdue</div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </motion.div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default WorkspaceDashboard\r\n"],"names":[],"mappings":"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","debugId":null}}]
}